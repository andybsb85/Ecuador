<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>
<% content_for :title,  @destination.name%>

<div class="content-body">
  <div class ="country-content">
    <ul class="breadcrumbs">
      <li><%=link_to t('.ecuadorTourism'),  index_path%></li>
      <li><%=link_to t('.destinations'), destination_list_index_path%></li>
      <li><%=link_to @destination.name, :class => 'current' %></li>
    </ul>
    <div class ="row">
      <div class= "large-3 columns">
        <%= render "shared/linkregion" %>
      </div>
      <div class= "large-9 columns">
       <h4><strong> <%= @destination.name %></strong></h4>
        <div class="row">
          <div class = "large-9 columns">
            <ul class="social-share-list list-inline">
              <div class="row">
                <div class = "large-3 columns">
                  <li class="twt">
                    <%= tweet_button count: 'horizontal' %>
                  </li>
                </div>
                <div class = "large-9 columns">
                  <li class="pi">
                    <%= pinit_button(url: request.url, media: @destination.image_url, description: "Amazing Picture") %>
                  </li>
                  
                </div>
                <div class = "large-3 columns">
                  <li class="fb">
                    <%= like_button(690575874330211) %>
                  </li>
                </div>
                <div class = "large-9 columns">
                  <li class = "gp">
                    <%= google_plus_button %>
                  </li>
                </div>
              </div>
            </ul>
          </div>
          <div class = "large-3 columns">
            <h5>Share:</h5><%= social_share_button_tag(@destination.image_url) %>         
          </div>
        </div>
        <div class="row"> 
          <div class="div-orbit">
           <ul class="example-orbit-content" data-orbit>
          <li data-orbit-slide="headline-1">
            <div>
             <%= image_tag(@destination.image_url) %>
            </div>
          </li>
          <li data-orbit-slide="headline-2">
            <div>
             <%= image_tag(@destination.image_url_two) %>
            </div>
          </li>
          <li data-orbit-slide="headline-3">
            <div>
              <%= image_tag(@destination.image_url_three) %>
            </div>
          </li>
        </ul>
      </div>
        </div>
        <div class="row">    
          <div class="content-destination">
            <% form_id = "destination_#{@destination.id}_rating" %>
              <% if user_signed_in? %> <!-- To avoid throwing an exception if no user is signed in -->
                <% user_id = current_user.id %>
              <% else %>
                <% user_id = -1 %>
              <% end %>        
            <%= form_for @destination.ratings.find_or_create_by(user_id: user_id), :html => {:id => form_id, :class => "star_rating_form"} do |f| %>
            <%= f.text_field :destination_id, :value => @destination.id %>
            <%= f.text_field :user_id, :value => current_user.id %>
            <%= f.text_field :stars, :id => form_id + "_stars" %>
            <% end %>
            <% (1..5).each do |i| %>
           <li class="rating_star" id="<%= form_id %>_<%= i %>" data-stars="<%= i   %>" data-form-id="<%= form_id %>"></li>
          <% end %>
        
        <div id="average_rating" style="display:inline;"><%= @destination.avg_rating %></div>
        <p>
          <strong>Description:</strong>
          <%= @destination.description %>
        </p>

        <p>
          <strong>Address:</strong>
          <%= @destination.address %>
        </p>

        <p>
          <strong>Phone:</strong>
          <%= @destination.phone %>
        </p>

        <p>
          <strong>Website:</strong>
          <%= @destination.website %>
        </p>
      </div>
        <div class = "map-destination">
          <div style='width: 100%;'>
            <div id="map" style='width: 100%; height: 290px;'></div>
          </div>
        </div>
      </div>
        <div class="row">
           <div class = "large-12 columns">
             <div class ="video">
               <div class="flex-video">
                 <iframe width="354" height="210" src="//<%= @destination.video_url %>" frameborder="0" >                </iframe>
               </div>
             </div>
           </div>
         </div>
      </div>
    </div>
  </div>
</div>

<%= content_for :scripts do %>
  <script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
  markers = handler.addMarkers(<%=raw @hash.to_json %>);        
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
  handler.getMap().setZoom(14);
  });
</script>
  <script type="text/javascript">
  $('#star').raty({
    readOnly: true,
    stars: <%= @destination.try(:average_rating) %>,
    path: '/assets'
  });

  $('#user_star').raty({
    stars: <%= @rating.try(:stars) %>,
    path: '/assets',
    click: function(stars, evt) {
      $.ajax({
        url: '/ratings/' + <%= @rating.try(:id) %>,
        type: 'PATCH',
        data: { stars: stars }
      });
    }
  });
</script>
<% end %>